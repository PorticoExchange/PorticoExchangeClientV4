.\" -*- mode: troff; coding: utf-8 -*-
.TH "LIGHTNING-CREATEONION" "7" "" "Core Lightning 0.12.1" ""
.SH
NAME
.LP
lightning-createonion -- Low-level command to create a custom onion
.SH
SYNOPSIS
.LP
\fBcreateonion\fR \fIhops\fR \fIassocdata\fR [\fIsession_key\fR] [\fIonion_size\fR]
.SH
DESCRIPTION
.LP
The \fBcreateonion\fR RPC command allows the caller to create a custom onion
with custom payloads at each hop in the route. A custom onion can be used to
implement protocol extensions that are not supported by Core Lightning directly.
.PP
The \fIhops\fR parameter is a JSON list of dicts, each specifying a node and the
payload destined for that node. The following is an example of a 3 hop onion:
.LP
.EX
[
    {
        \(dqpubkey\(dq: \(dq022d223620a359a47ff7f7ac447c85c46c923da53389221a0054c11c1e3ca31d59\(dq,
        \(dqpayload\(dq: \(dq00000067000001000100000000000003e90000007b000000000000000000000000000000000000000000000000\(dq
    }, {
        \(dqpubkey\(dq: \(dq035d2b1192dfba134e10e540875d366ebc8bc353d5aa766b80c090b39c3a5d885d\(dq,
        \(dqpayload\(dq: \(dq00000067000003000100000000000003e800000075000000000000000000000000000000000000000000000000\(dq
    }, {
        \(dqstyle\(dq: \(dqlegacy\(dq,
        \(dqpubkey\(dq: \(dq0382ce59ebf18be7d84677c2e35f23294b9992ceca95491fcf8a56c6cb2d9de199\(dq,
        \(dqpayload\(dq: \(dq00000067000003000100000000000003e800000075000000000000000000000000000000000000000000000000\(dq
    }
]
.EE
.PP
The \fIhops\fR parameter is very similar to the result from \fCgetroute\fR however it
needs to be modified slightly. The following is the \fCgetroute\fR response from
which the above \fIhops\fR parameter was generated:
.LP
.EX
[
    {
        \(dqid\(dq: \(dq022d223620a359a47ff7f7ac447c85c46c923da53389221a0054c11c1e3ca31d59\(dq,
        \(dqchannel\(dq: \(dq103x2x1\(dq,
        \(dqdirection\(dq: 1,
        \(dqmsatoshi\(dq: 1002,
        \(dqamount_msat\(dq: \(dq1002msat\(dq,
        \(dqdelay\(dq: 21,
    }, {
        \(dqid\(dq: \(dq035d2b1192dfba134e10e540875d366ebc8bc353d5aa766b80c090b39c3a5d885d\(dq,
        \(dqchannel\(dq: \(dq103x1x1\(dq,
        \(dqdirection\(dq: 0,
        \(dqmsatoshi\(dq: 1001,
        \(dqamount_msat\(dq: \(dq1001msat\(dq,
        \(dqdelay\(dq: 15,
    }, {
        \(dqid\(dq: \(dq0382ce59ebf18be7d84677c2e35f23294b9992ceca95491fcf8a56c6cb2d9de199\(dq,
        \(dqchannel\(dq: \(dq103x3x1\(dq,
        \(dqdirection\(dq: 0,
        \(dqmsatoshi\(dq: 1000,
        \(dqamount_msat\(dq: \(dq1000msat\(dq,
        \(dqdelay\(dq: 9,
    }
]
.EE
.IP "\(bu" 2
Notice that the payload in the \fIhops\fR parameter is the hex-encoded version
of the parameters in the \fCgetroute\fR response.
.if n \
.sp -1
.if t \
.sp -0.25v
.IP "\(bu" 2
Except for the pubkey, the values are shifted left by one, i.e., the 1st
payload in \fCcreateonion\fR corresponds to the 2nd set of values from \fCgetroute\fR.
.if n \
.sp -1
.if t \
.sp -0.25v
.IP "\(bu" 2
The final payload is a copy of the last payload sans \fCchannel\fR
.LP
These rules are directly derived from the onion construction. Please refer
\fBBOLT 04\fR <\fIhttps://github.com/lightning/bolts/blob/master/04-onion-routing.md\fR> for details and rationale.
.PP
The \fIassocdata\fR parameter specifies the associated data that the onion should
commit to. If the onion is to be used to send a payment later it MUST match
the \fCpayment_hash\fR of the payment in order to be valid.
.PP
The optional \fIsession_key\fR parameter can be used to specify a secret that is
used to generate the shared secrets used to encrypt the onion for each hop. It
should only be used for testing or if a specific shared secret is
important. If not specified it will be securely generated internally, and the
shared secrets will be returned.
.PP
The optional \fIonion_size\fR parameter specifies a size different from the default
payment onion (1300 bytes). May be used for custom protocols like trampoline
routing.
.SH
RETURN VALUE
.LP
On success, an object is returned, containing:
.IP "\(bu" 2
\fBonion\fR (hex): the onion packet (\fIonion_size\fR bytes)
.if n \
.sp -1
.if t \
.sp -0.25v
.IP "\(bu" 2
\fBshared_secrets\fR (array of secrets): one shared secret for each node in the \fIhops\fR parameter:
.RS
.IP "\(bu" 2
the shared secret with this hop (always 64 characters)
.RE
.SH
EXAMPLE
.LP
The following example is the result of calling \fIcreateonion\fR with the
above hops parameter:
.LP
.EX
{
    \(dqonion\(dq: \(dq0003f3f80d2142b953319336d2fe4097[...]6af33fcf4fb113bce01f56dd62248a9e5fcbbfba35c\(dq,
    \(dqshared_secrets\(dq: [
        \(dq88ce98c73e4d9293ab1797b0a913fe9bca0213a566252047d01b8af6da871f3e\(dq,
        \(dq4474d296810e57bd460ef8b83d2e7d288321f8a99ff7686f87384699747bcfc4\(dq,
        \(dq2a862e4123e01799a732be487fbce297f7dc7cc1467e410f18369cfee476adc2\(dq
    ]
}
.EE
.PP
The \fConion\fR corresponds to 1366 hex-encoded bytes. Each shared secret consists
of 32 hex-encoded bytes. Both arguments can be passed on to \fBsendonion\fR.
.SH
AUTHOR
.LP
Christian Decker <\fIdecker.christian@gmail.com\fR> is mainly responsible.
.SH
SEE ALSO
.LP
lightning-sendonion(7), lightning-getroute(7)
.SH
RESOURCES
.LP
Main web site: \fIhttps://github.com/ElementsProject/lightning\fR
\" SHA256STAMP:f7738087063669cc4ec6ee03088e2d25188db3ce95bf3aed9896aae7ff658d78
